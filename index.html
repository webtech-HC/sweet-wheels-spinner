<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sweet Wheels — Dessert Truck</title>
<meta name="description" content="Treat Yourself — Sweet Wheels Desserts. Menu highlights, today’s location, and a fair, fun 5-slice deal spinner." />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#3B3A40; --muted:#8E90A0; --cream:#FFF7EF;
  --straw:#F8B8C9; --mint:#BFEEDF; --blue:#BFD6FF; --lav:#DCC6FF; --lemon:#FFE3A1;
  --panel:#fff; --line:rgba(30,33,36,.10); --ring:rgba(191,214,255,.55);
}
*{box-sizing:border-box}
html,body{margin:0;background:linear-gradient(120deg,var(--cream),#fff);color:var(--ink);font-family:Inter,system-ui,Arial,sans-serif}
h1,h2,h3{font-family:Fredoka,system-ui,Arial,sans-serif;margin:.2rem 0 .6rem}
h1{font-size:clamp(1.8rem,3.2vw,3rem);line-height:1.1}
h2{font-size:clamp(1.3rem,2.1vw,1.8rem)}
.wrap{max-width:1100px;margin:0 auto;padding:clamp(14px,2vw,22px)}
.section{padding:clamp(18px,3.2vw,40px) 0}
.sub{color:var(--muted)} .accent{color:#5b5b66}
.btn{background:var(--straw);border:1px solid var(--line);border-radius:18px;padding:.7rem 1rem;
  box-shadow:0 6px 18px rgba(239,154,174,.18), inset 0 2px 0 rgba(255,255,255,.85);
  text-decoration:none;display:inline-flex;gap:.5rem;align-items:center;font-weight:700;color:inherit}
.btn:hover{filter:saturate(1.02);transform:translateY(-1px)}
.btn.line{background:#fff} .btn.mini{padding:.5rem .8rem;border-radius:14px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:22px;padding:14px 16px;
  box-shadow:0 18px 40px rgba(32,33,36,.10), inset 0 2px 0 rgba(255,255,255,.85)}
/* Spinner */
.deals-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:22px;align-items:center}
@media (max-width:900px){ .deals-grid{grid-template-columns:1fr} }
.stage{position:relative;display:grid;place-items:center;padding:18px}
.rim{position:absolute;inset:0;border-radius:28px;
  box-shadow:0 26px 60px rgba(32,33,36,.14), inset 0 8px 0 rgba(255,255,255,.85);
  background:radial-gradient(120px 80px at 50% 40%,#fff 0%, #fff 50%, rgba(0,0,0,.02) 100%)}
.canvas-wrap{position:relative;display:inline-block;border-radius:50%;
  padding:14px;background:#fff;box-shadow:0 18px 38px rgba(0,0,0,.12), inset 0 4px 0 rgba(255,255,255,.85);
  width:min(420px,80vw)}
.pointer{position:absolute;top:-14px;left:50%;transform:translateX(-50%);width:0;height:0;
  border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:22px solid #ffb2c4;
  filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:.4rem}
.coupon{font-family:ui-monospace,Menlo,Consolas,monospace;background:#f7f7f9;border:1px dashed #cfcfd8;border-radius:10px;padding:6px 8px;display:inline-block;cursor:pointer}
.muted{color:var(--muted)} .small{font-size:.9rem}
.badge{background:var(--mint);border:1px solid #9FD7C6;border-radius:10px;padding:2px 8px;font-weight:700}
.badge.warn{background:#FFE3E9;border-color:#F4C2CF}
.topbar{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:50}
.topbar .wrap{display:flex;align-items:center;justify-content:space-between;gap:12px}
.pill{background:#fff;border:1px solid var(--line);border-radius:999px;padding:.35rem .7rem;box-shadow:0 4px 16px rgba(0,0,0,.06)}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap">
    <span class="pill" id="today-pill" aria-live="polite">Today: …</span>
    <nav class="mini-nav" aria-label="Utility">
      <a class="btn mini" href="#order">Order Ahead</a>
    </nav>
  </div>
</header>

<div id="root"></div>

<!-- React 18 (UMD) -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

<script>
const {useEffect, useMemo, useRef, useState} = React;

/* ---------- Utilities ---------- */
const prizes = ["10% OFF","Free Topping","$1 Off Drink","BOGO 50%","Mystery Sweet"];
const colors = ["#F8B8C9","#BFEEDF","#BFD6FF","#DCC6FF","#FFE3A1"];
const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
const urlParams = new URLSearchParams(location.search);
const force = urlParams.get('force');
function todayKey(){ return new Date().toISOString().slice(0,10); }
function alreadySpun(){ return localStorage.getItem('sw_spin') === todayKey(); }
function setSpun(){ localStorage.setItem('sw_spin', todayKey()); }
function couponCode(){ const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; let out="SWEET-"; for(let i=0;i<5;i++) out+=s[Math.floor(Math.random()*s.length)]; return out; }
function clamp01(t){ return Math.max(0, Math.min(1, t)); }
function easeOutCubic(t){ t=clamp01(t); return 1-Math.pow(1-t,3); }
function normAngle(a){ return (a%360+360)%360; }

/* ---------- Spinner Component (SVG) ---------- */
function Spinner({onWin}) {
  const N = 5;                 // segments
  const slice = 360/N;         // 72°
  const baseStart = -90;       // top = pointer direction
  const centers = useMemo(()=>Array.from({length:N}, (_,i)=> baseStart + (i+0.5)*slice), [N]);

  // rotation in degrees, clockwise; applied to the whole wheel <g>
  const [rot, setRot] = useState(0);
  const [spinning, setSpinning] = useState(false);

  // pick index (force via query ok)
  function pickIndex(){
    if (force){
      const n = +force;
      if (n>=1 && n<=N) return n-1;
      const i = prizes.findIndex(p => p.toLowerCase()===String(force).toLowerCase());
      if (i!==-1) return i;
    }
    return Math.floor(Math.random()*N);
  }

  // Given current rotation "rot", compute the additional rotation required to land
  // the *center* of segment i at the pointer (top). We want:
  // (centers[i] + finalRot) ≡ -90   (mod 360)
  // => finalRot ≡ -90 - centers[i]  (mod 360)
  function targetModForIndex(i){ return normAngle(-90 - centers[i]); }

  function spin(){
    if (spinning || alreadySpun()) return;
    const i = pickIndex();
    const turns = prefersReduced ? 1 : 6;
    const duration = prefersReduced ? 160 : 4800;

    const current = rot;
    const targetMod = targetModForIndex(i);
    const currentMod = normAngle(current);
    const deltaMod = normAngle(targetMod - currentMod); // shortest positive delta to exact modulo
    const finalRot = current + turns*360 + deltaMod;     // deterministic, ends exactly at i

    setSpinning(true);
    const start = performance.now();
    function frame(now){
      const t = Math.min(1, (now-start)/duration);
      const eased = easeOutCubic(t);
      setRot(current + (finalRot-current)*eased);
      if (t<1) requestAnimationFrame(frame);
      else {
        setRot(finalRot);
        setSpinning(false);
        setSpun();
        onWin(prizes[i]);
      }
    }
    requestAnimationFrame(frame);
  }

  useEffect(()=>{ if (alreadySpun()) onWin(null,true); },[]);

  // Responsive size
  const size = 420;
  const r = size/2 - 8;
  const cx = size/2, cy = size/2;

  function arcPath(a0,a1){
    const rad = (d)=> d*Math.PI/180;
    const x = (ang)=> cx + r*Math.cos(rad(ang));
    const y = (ang)=> cy + r*Math.sin(rad(ang));
    const large = (a1-a0) > 180 ? 1 : 0;
    return `M ${cx} ${cy} L ${x(a0)} ${y(a0)} A ${r} ${r} 0 ${large} 1 ${x(a1)} ${y(a1)} Z`;
  }

  const segments = Array.from({length:N}, (_,i)=>({
    start: baseStart + i*slice,
    end: baseStart + (i+1)*slice,
    fill: colors[i],
    label: prizes[i],
    mid: baseStart + i*slice + slice/2
  }));

  const canSpin = !spinning && !alreadySpun();

  return (
    React.createElement('div', {className:'spinner card', 'aria-live':'polite'},
      React.createElement('div',{className:'stage'},
        React.createElement('div',{className:'rim','aria-hidden':'true'}),
        React.createElement('div',{className:'canvas-wrap'},
          React.createElement('span',{className:'pointer','aria-hidden':'true'}),
          React.createElement('svg',{width:size,height:size,viewBox:`0 0 ${size} ${size}`,role:'img','aria-label':'Prize wheel'},
            React.createElement('g',{transform:`rotate(${rot} ${cx} ${cy})`},
              segments.map((s,idx)=>
                React.createElement('g',{key:idx},
                  React.createElement('path',{d:arcPath(s.start,s.end),fill:s.fill,stroke:'#fff',strokeWidth:2}),
                  React.createElement('text',{
                    x:cx,y:cy,
                    transform:`rotate(${s.mid} ${cx} ${cy}) translate(${r-32},0) rotate(90 ${cx} ${cy})`,
                    fill:'#5b5b66',
                    'font-family':'Fredoka, Arial, sans-serif',
                    'font-weight':'700',
                    'font-size':'16',
                    'text-anchor':'middle',
                    'dominant-baseline':'middle'
                  }, s.label)
                )
              ),
              // inner ring
              React.createElement('circle',{cx,cy,r:r*0.72,fill:'none',stroke:'rgba(255,255,255,.75)',strokeWidth:4})
            )
          )
        )
      ),
      React.createElement('div',{className:'controls'},
        React.createElement('button',{id:'spinBtn',className:'btn',disabled:!canSpin,onClick:spin},
          canSpin ? 'Spin' : (alreadySpun() ? 'Come back tomorrow' : 'Spinning…')
        ),
        React.createElement('button',{
          id:'resetBtn',className:'btn',type:'button',
          onClick:()=>{ localStorage.removeItem('sw_spin'); onWin(null,false,true); }
        },'Reset (dev)')
      ),
      React.createElement('p',{id:'spinNote',className:'muted small'},
        alreadySpun()? 'One spin per guest per day.' : 'Good luck!'
      )
    )
  );
}

/* ---------- Page ---------- */
function App(){
  const [prize,setPrize] = useState(null);
  const [spun,setSpunState] = useState(alreadySpun());

  function handleWin(label, wasAlready=false, wasReset=false){
    if (wasReset){ setPrize(null); setSpunState(false); return; }
    if (wasAlready){ setSpunState(true); return; }
    setPrize(label); setSpunState(true);
  }

  useEffect(()=>{
    const sched = [
      {day:"Sun", place:"Market Square", hours:"12–6 PM"},
      {day:"Mon", place:"Closed", hours:"—"},
      {day:"Tue", place:"Old City", hours:"11–3 PM"},
      {day:"Wed", place:"UT Campus", hours:"12–5 PM"},
      {day:"Thu", place:"Fountain City", hours:"12–6 PM"},
      {day:"Fri", place:"Downtown", hours:"1–8 PM"},
      {day:"Sat", place:"Farmer’s Market", hours:"9–2 PM"}
    ];
    const t = new Date().getDay();
    const it = sched[t];
    const pill = document.getElementById('today-pill');
    const text = it.place==="Closed" ? "Closed" :
      `<a href="https://maps.google.com/?q=${encodeURIComponent(it.place)}" target="_blank" rel="noopener">${it.place}</a>`;
    pill.innerHTML = `Today: ${text} • ${it.hours}`;
  },[]);

  return (
    React.createElement(React.Fragment,null,
      React.createElement('section',{className:'section'},
        React.createElement('div',{className:'wrap'},
          React.createElement('h1',null,'Treat Yourself — ',React.createElement('span',{className:'accent'},'Sweet Wheels Desserts')),
          React.createElement('p',{className:'sub'},'Light, bright, and fluffy treats on wheels. 🍦')
        )
      ),
      React.createElement('section',{id:'deals',className:'section','aria-labelledby':'deals-title'},
        React.createElement('div',{className:'wrap deals-grid'},
          React.createElement('div',null,
            React.createElement('h2',{id:'deals-title'},'Sweet Wheels, Sweet Deals'),
            React.createElement('p',{className:'muted'},'One spin per guest per day. Show your win screen at checkout. Not stackable; valid today only.'),
            React.createElement(Spinner,{onWin:handleWin})
          ),
          React.createElement('aside',{className:'card','aria-live':'polite'},
            React.createElement('h3',{style:{marginTop:0}},'Your prize'),
            React.createElement('p',{id:'winText',className:'muted'}, prize ? `🎉 ${prize}` : 'Spin to see what you get!'),
            React.createElement('p',{
              id:'winCode',
              className:'coupon',
              title:'Click to copy',
              hidden: !prize,
              onClick: async (e)=>{
                const code = e.currentTarget.textContent.replace('Code: ','') || couponCode();
                try{
                  await navigator.clipboard.writeText(code);
                  const t = e.currentTarget.textContent; e.currentTarget.textContent = t + '  ✓ copied';
                  setTimeout(()=> e.currentTarget.textContent = t, 1400);
                }catch{}
              }
            }, prize ? 'Code: '+couponCode() : 'Code: SWEET-00000')
          )
        )
      ),
      React.createElement('footer',{className:'section'},
        React.createElement('div',{className:'wrap'},
          React.createElement('p',null,'© ', new Date().getFullYear(),' Sweet Wheels. Made with 💗 & sugar.')
        )
      )
    )
  );
}

/* ---------- mount ---------- */
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
