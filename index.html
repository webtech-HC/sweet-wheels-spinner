<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sweet Wheels — Dessert Truck</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#3B3A40; --muted:#8E90A0; --cream:#FFF7EF;
  --straw:#F8B8C9; --mint:#BFEEDF; --blue:#BFD6FF; --lav:#DCC6FF; --lemon:#FFE3A1;
  --panel:#fff; --line:rgba(30,33,36,.10); --ring:rgba(191,214,255,.55);
}
*{box-sizing:border-box}
html,body{margin:0;background:linear-gradient(120deg,var(--cream),#fff);color:var(--ink);font-family:Inter,system-ui,Arial,sans-serif}
h1,h2,h3{font-family:Fredoka,system-ui,Arial,sans-serif;margin:.2rem 0 .6rem}
h1{font-size:clamp(1.8rem,3.2vw,3rem);line-height:1.1}
h2{font-size:clamp(1.3rem,2.1vw,1.8rem)}
.wrap{max-width:1100px;margin:0 auto;padding:clamp(14px,2vw,22px)}
.section{padding:clamp(18px,3.2vw,40px) 0}
.sub{color:var(--muted)} .accent{color:#5b5b66}
.btn{background:var(--straw);border:1px solid var(--line);border-radius:18px;padding:.7rem 1rem;
  box-shadow:0 6px 18px rgba(239,154,174,.18), inset 0 2px 0 rgba(255,255,255,.85);
  text-decoration:none;display:inline-flex;gap:.5rem;align-items:center;font-weight:700;color:inherit}
.btn:hover{filter:saturate(1.02);transform:translateY(-1px)}
.btn.line{background:#fff} .btn.mini{padding:.5rem .8rem;border-radius:14px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:22px;padding:14px 16px;
  box-shadow:0 18px 40px rgba(32,33,36,.10), inset 0 2px 0 rgba(255,255,255,.85)}
/* Spinner visuals */
.deals-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:22px;align-items:center}
@media (max-width:900px){ .deals-grid{grid-template-columns:1fr} }
.spinner{display:grid;gap:10px;justify-items:center}
.stage{position:relative;display:flex;align-items:center;justify-content:center;padding:18px;max-width:600px;margin:0 auto}
.rim{position:absolute;inset:0;border-radius:28px;
  box-shadow:0 26px 60px rgba(32,33,36,.14), inset 0 8px 0 rgba(255,255,255,.85);
  background:radial-gradient(120px 80px at 50% 40%,#fff 0%, #fff 50%, rgba(0,0,0,.02) 100%)}
.wheel-wrap{display:block; width:min(92vw,520px); max-width:520px; aspect-ratio:1/1;
  background:#fff; border-radius:50%; padding:12px;
  box-shadow:0 18px 38px rgba(0,0,0,.12), inset 0 4px 0 rgba(255,255,255,.85)}
.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:.4rem}
.coupon{font-family:ui-monospace,Menlo,Consolas,monospace;background:#f7f7f9;border:1px dashed #cfcfd8;border-radius:10px;padding:6px 8px;display:inline-block;cursor:pointer}
.muted{color:var(--muted)} .small{font-size:.9rem}
.badge{background:var(--mint);border:1px solid #9FD7C6;border-radius:10px;padding:2px 8px;font-weight:700}
.badge.warn{background:#FFE3E9;border-color:#F4C2CF}
.topbar{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:50}
.topbar .wrap{display:flex;align-items:center;justify-content:space-between;gap:12px}
.pill{background:#fff;border:1px solid var(--line);border-radius:999px;padding:.35rem .7rem;box-shadow:0 4px 16px rgba(0,0,0,.06)}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap">
    <span class="pill" id="today-pill" aria-live="polite">Today: …</span>
    <nav class="mini-nav" aria-label="Utility"><a class="btn mini" href="#order">Order Ahead</a></nav>
  </div>
</header>

<div id="root"></div>

<!-- React 18 UMD -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

<script>
const {useEffect, useMemo, useRef, useState} = React;

/* ===== Utils ===== */
const prizes = ["10% OFF","Free Topping","$1 Off Drink","BOGO 50%","Mystery Sweet"];
const colors = ["#F8B8C9","#BFEEDF","#BFD6FF","#DCC6FF","#FFE3A1"];
const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
const urlParams = new URLSearchParams(location.search);
const force = urlParams.get('force');
function todayKey(){ return new Date().toISOString().slice(0,10); }
function alreadySpun(){ return localStorage.getItem('sw_spin') === todayKey(); }
function setSpun(){ localStorage.setItem('sw_spin', todayKey()); }
function couponCode(){ const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; let out="SWEET-"; for(let i=0;i<5;i++) out+=s[Math.floor(Math.random()*s.length)]; return out; }
function clamp01(t){ return Math.max(0, Math.min(1, t)); }
function easeOutCubic(t){ t=clamp01(t); return 1-Math.pow(1-t,3); }
function normAngle(a){ return (a%360+360)%360; }

/* ===== Responsive observer ===== */
function useSize(ref){
  const [w,setW]=useState(420);
  useEffect(()=>{
    if(!ref.current) return;
    const ro = new ResizeObserver(entries=>{
      for(const e of entries){
        const cw = e.contentRect.width;
        setW(Math.max(260, Math.min(520, cw))); // clamp 260–520
      }
    });
    ro.observe(ref.current);
    return ()=>ro.disconnect();
  },[ref]);
  return w;
}

/* ===== Spinner (SVG, responsive, upright text) ===== */
function Spinner({onWin}){
  const N = 5, slice = 360/N, baseStart=-90;  // pointer at top
  const centers = useMemo(()=>Array.from({length:N},(_,i)=> baseStart + (i+0.5)*slice),[]);
  const [rot,setRot]=useState(0);
  const [spinning,setSpinning]=useState(false);

  // measure container to size the wheel
  const wrapRef = useRef(null);
  const size = useSize(wrapRef);              // 260..520
  const r = size/2 - size*0.02, cx=size/2, cy=size/2;
  const stroke = Math.max(2, size*0.004);
  const ringR = r*0.68;
  const labelMargin = size*0.09;
  const pointerW = size*0.08, pointerH = size*0.10, pointerGap = size*0.01;

  function pickIndex(){
    if (force){
      const n = +force; if(n>=1 && n<=N) return n-1;
      const i = prizes.findIndex(p=>p.toLowerCase()===String(force).toLowerCase());
      if (i!==-1) return i;
    }
    return Math.floor(Math.random()*N);
  }
  function targetModForIndex(i){ return normAngle(-90 - centers[i]); }

  function spin(){
    if (spinning || alreadySpun()) return;
    const i = pickIndex();
    const turns = prefersReduced ? 1 : 6;
    const duration = prefersReduced ? 160 : 4800;
    const current = rot;
    const targetMod = targetModForIndex(i);
    const currentMod = normAngle(current);
    const deltaMod = normAngle(targetMod - currentMod);
    const finalRot = current + turns*360 + deltaMod;

    setSpinning(true);
    const start = performance.now();
    function frame(now){
      const t = Math.min(1, (now-start)/duration);
      const eased = easeOutCubic(t);
      setRot(current + (finalRot-current)*eased);
      if (t<1) requestAnimationFrame(frame);
      else { setRot(finalRot); setSpinning(false); setSpun(); onWin(prizes[i]); }
    }
    requestAnimationFrame(frame);
  }

  useEffect(()=>{ if (alreadySpun()) onWin(null,true); },[]);

  function arcPath(a0,a1){
    const rad = (d)=> d*Math.PI/180;
    const x = (ang)=> cx + r*Math.cos(rad(ang));
    const y = (ang)=> cy + r*Math.sin(rad(ang));
    const large = (a1-a0) > 180 ? 1 : 0;
    return `M ${cx} ${cy} L ${x(a0)} ${y(a0)} A ${r} ${r} 0 ${large} 1 ${x(a1)} ${y(a1)} Z`;
  }

  const segments = Array.from({length:N},(_,i)=>({
    start: baseStart + i*slice,
    end: baseStart + (i+1)*slice,
    fill: colors[i],
    label: prizes[i],
    mid: baseStart + i*slice + slice/2
  }));

  const canSpin = !spinning && !alreadySpun();

  return (
    React.createElement('div',{className:'spinner card','aria-live':'polite'},
      React.createElement('div',{className:'stage'},
        React.createElement('div',{className:'rim','aria-hidden':'true'}),
        React.createElement('div',{className:'wheel-wrap', ref:wrapRef},
          React.createElement('svg',{
            width:'100%', height:'100%', viewBox:`0 0 ${size} ${size}`,
            preserveAspectRatio:'xMidYMid meet', role:'img','aria-label':'Prize wheel'
          },
            // wheel group
            React.createElement('g',{transform:`rotate(${rot} ${cx} ${cy})`},
              segments.map((s,idx)=>
                React.createElement('g',{key:idx},
                  React.createElement('path',{d:arcPath(s.start,s.end), fill:s.fill, stroke:'#fff', strokeWidth:stroke}),
                  // upright text:
                  (()=> {
                    const a = normAngle(s.mid);
                    const needsFlip = a>90 && a<270;
                    // rotate to mid, move outward, then rotate text tangent; flip if needed
                    const rot1 = s.mid, tx = r - labelMargin;
                    const extra = needsFlip ? 180 : 0;
                    return React.createElement('text',{
                      x:cx, y:cy,
                      transform:`rotate(${rot1} ${cx} ${cy}) translate(${tx} 0) rotate(${90+extra})`,
                      fill:'#5b5b66',
                      'font-family':'Fredoka, Arial, sans-serif','font-weight':'700',
                      'font-size': Math.max(12, size*0.038), 'text-anchor':'middle', 'dominant-baseline':'middle'
                    }, s.label);
                  })()
                )
              ),
              // inner ring
              React.createElement('circle',{cx,cy,r:ringR, fill:'none', stroke:'rgba(255,255,255,.8)', strokeWidth:stroke*2})
            ),
            // pointer (DOWNWARD triangle, always centered)
            (()=> {
              const tipY = cy - r - pointerGap;                         // tip just outside rim
              const baseY = tipY + pointerH;
              const leftX = cx - pointerW/2, rightX = cx + pointerW/2;
              const d = `M ${cx} ${tipY} L ${rightX} ${baseY} L ${leftX} ${baseY} Z`;
              return React.createElement('path',{d, fill:'#ffb2c4', stroke:'#e39aae', strokeWidth:stroke, 'aria-hidden':'true'});
            })()
          )
        )
      ),
      React.createElement('div',{className:'controls'},
        React.createElement('button',{className:'btn',disabled:!canSpin,onClick:spin},
          canSpin ? 'Spin' : (alreadySpun() ? 'Come back tomorrow' : 'Spinning…')
        ),
        React.createElement('button',{className:'btn',type:'button',onClick:()=>{localStorage.removeItem('sw_spin'); onWin(null,false,true);}},'Reset (dev)')
      ),
      React.createElement('p',{className:'muted small'}, alreadySpun()? 'One spin per guest per day.' : 'Good luck!')
    )
  );
}

/* ===== Page ===== */
function App(){
  const [prize,setPrize] = useState(null);

  function handleWin(label, wasAlready=false, wasReset=false){
    if (wasReset){ setPrize(null); return; }
    if (wasAlready) return;
    setPrize(label);
  }

  // simple “today” pill
  useEffect(()=>{
    const sched = [
      {d:"Sun", p:"Market Square", h:"12–6 PM"},
      {d:"Mon", p:"Closed", h:"—"},
      {d:"Tue", p:"Old City", h:"11–3 PM"},
      {d:"Wed", p:"UT Campus", h:"12–5 PM"},
      {d:"Thu", p:"Fountain City", h:"12–6 PM"},
      {d:"Fri", p:"Downtown", h:"1–8 PM"},
      {d:"Sat", p:"Farmer’s Market", h:"9–2 PM"}
    ];
    const t = new Date().getDay(), it = sched[t];
    const pill = document.getElementById('today-pill');
    pill.innerHTML = `Today: ${it.p==="Closed"?"Closed":`<a href="https://maps.google.com/?q=${encodeURIComponent(it.p)}" target="_blank" rel="noopener">${it.p}</a>`} • ${it.h}`;
  },[]);

  return (
    React.createElement(React.Fragment,null,
      React.createElement('section',{className:'section'},
        React.createElement('div',{className:'wrap'},
          React.createElement('h1',null,'Treat Yourself — ',React.createElement('span',{className:'accent'},'Sweet Wheels Desserts')),
          React.createElement('p',{className:'sub'},'Light, bright, and fluffy treats on wheels. 🍦')
        )
      ),
      React.createElement('section',{id:'deals',className:'section','aria-labelledby':'deals-title'},
        React.createElement('div',{className:'wrap deals-grid'},
          React.createElement('div',null,
            React.createElement('h2',{id:'deals-title'},'Sweet Wheels, Sweet Deals'),
            React.createElement('p',{className:'muted'},'One spin per guest per day. Show your win screen at checkout. Not stackable; valid today only.'),
            React.createElement(Spinner,{onWin:handleWin})
          ),
          React.createElement('aside',{className:'card','aria-live':'polite'},
            React.createElement('h3',{style:{marginTop:0}},'Your prize'),
            React.createElement('p',{id:'winText',className:'muted'}, prize ? `🎉 ${prize}` : 'Spin to see what you get!'),
            React.createElement('p',{
              id:'winCode',className:'coupon',title:'Click to copy',hidden: !prize,
              onClick: async (e)=>{
                const code = e.currentTarget.textContent.replace('Code: ','') || couponCode();
                try{
                  await navigator.clipboard.writeText(code);
                  const t = e.currentTarget.textContent; e.currentTarget.textContent = t + '  ✓ copied';
                  setTimeout(()=> e.currentTarget.textContent = t, 1400);
                }catch{}
              }
            }, prize ? 'Code: '+couponCode() : 'Code: SWEET-00000')
          )
        )
      ),
      React.createElement('footer',{className:'section'},
        React.createElement('div',{className:'wrap'},
          React.createElement('p',null,'© ', new Date().getFullYear(),' Sweet Wheels. Made with 💗 & sugar.')
        )
      )
    )
  );
}

/* mount */
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
